import Presentacion.*
import Musico.*
import Cancion.*
import MusicoDeGrupo.*
import VocalistaPopular.*
import Banda.*
import MusicoEspecial.*
import Instrumento.*
import Teatros.*
import Album.*
import Remix.*
import CriterioDeLetra.*
import CriterioDeTitulo.*
import CriterioDeDuracion.*
import HabilidadRequeridaException.*
import CancionInterpretadaException.*
import CompositorException.*
import Condiciones.*
import TiposMusico.*
import FormasDeCobro.*
import Representante.*

describe "Pruebas para los musicos" {
	
	
	///Musicos
	const joaquin = new MusicoDeGrupo(20, 5)
	const lucia = new VocalistaPopular(70, 20)
	const luisAlberto = new MusicoEspecial()
	const kike = new MusicoDeGrupo(60, 20)
	const soledad = new VocalistaPopular(55, 0)
	
	//Representantes
	const cachorro = new Representante(1982)
	const felix = new Representante(500)

	//Bandas
	const pimpinela = new Banda()
	const pimpisole = new Banda()
	const elEternoRetorno = new Banda()

	//Canciones
	const cisne = new Cancion("Cisne")
	const laFamilia = new Cancion("La Familia")
	const eres = new Cancion("Eres")
	const corazonAmericano = new Cancion("Corazón Americano")
	const almaDeDiamante = new Cancion("Alma de Diamante")
	const crisantemo = new Cancion("Crisantemo")
	const remixLaFamilia = new Remix("La Familia")
	const aliciaEnElPais = new Cancion("CanciÃ²n de Alicia en el país")
	
	//Instrumentos
	const gibson = new Instrumento("Gibson", 15)
	const gibsonRota = new Instrumento("Gibson", 5)
	const fender = new Instrumento("Fender", 10)
	
	//Presentaciones
	const presentacionLunaPark = new Presentacion((new Date(20, 04, 2017)), lunaPark)
	const presentacionLaTrastienda = new Presentacion((new Date(15, 11, 2017)), laTrastienda)
	const pdpalooza = new Presentacion((new Date(15, 12, 2017)), lunaPark)
	const presentacionPrixDami = new Presentacion((new Date(30,06,2017)), prixDami)
	const presentacionLaCueva = new Presentacion((new Date(05,01,2018)), laCueva)
	
	//Albumes
	const albumEspecialLaFamilia= new Album("Especial La Familia", (new Date(17, 06, 1992)))
	const albumLaSole = new Album("La Sole", (new Date(04, 02, 2005)))
	const albumParaLosArboles = new Album("Para Los árboles", (new Date(31, 03, 2003)))
	const albumJustCrisantemo = new Album("Just Crisantemo", (new Date(05, 12, 2007)))
	
	fixture{
		
		//Albumes
		albumEspecialLaFamilia.canciones([laFamilia])
		albumEspecialLaFamilia.copiasALaVenta(100000)
		albumEspecialLaFamilia.copiasVendidas(89000)
		
		albumLaSole.canciones([eres, corazonAmericano])
		albumLaSole.copiasALaVenta(200000)
		albumLaSole.copiasVendidas(130000)
		
		albumParaLosArboles.canciones([cisne, almaDeDiamante])
		albumParaLosArboles.copiasALaVenta(50000)
		albumParaLosArboles.copiasVendidas(49000)
		
		albumJustCrisantemo.canciones([crisantemo])
		albumJustCrisantemo.copiasALaVenta(28000)
		albumJustCrisantemo.copiasVendidas(27000)
		
		//musicos
//		joaquin.tiempoNecesarioParaInterpretarBienUnaCancion(300)
		joaquin.albumesQueEdito([albumEspecialLaFamilia])
		joaquin.tipoMusico((new MusicoLarguero(300)))
		joaquin.precio(100)
		joaquin.tipoDeCobro((new CobroPorCantidadDeArtistas()))
		
		lucia.tipoMusico((new MusicoPalabrero("familia")))
		lucia.precio(500)
		lucia.tipoDeCobro((new CobroPorCapacidad(5000)))
		
		soledad.albumesQueEdito([albumLaSole])
		soledad.tipoMusico((new MusicoPalabrero("amor")))
		soledad.precio(6000)
		soledad.tipoDeCobro((new CobroPorCantidadDeArtistas()))
		
		kike.tipoMusico((new MusicoImparero()))
		kike.precio(4000)
		kike.tipoDeCobro((new CobroPorExpectativaInflacionaria((new Date(8, 1, 2018)), 50)))
		
		luisAlberto.albumesQueEdito([albumParaLosArboles, albumJustCrisantemo])
		
		//Bandas
		pimpinela.agregarMiembroALaBanda(joaquin)
		pimpinela.agregarMiembroALaBanda(lucia)
		
		pimpisole.agregarMiembroALaBanda(soledad)
		pimpisole.agregarMiembroALaBanda(joaquin)
		pimpisole.agregarMiembroALaBanda(lucia)
		pimpisole.representante(cachorro)
		
		elEternoRetorno.agregarMiembroALaBanda(kike)
		elEternoRetorno.agregarMiembroALaBanda(luisAlberto)
		elEternoRetorno.representante(felix)
		
		
		//Canciones
		cisne.duracion(312)
		cisne.letra("Hoy el viento se abrió quedó vacío el aire una vez más y el manantial brotó y nadie está aquí y puedo ver que solo estallan las hojas al brillar")
		
		laFamilia.duracion(264)
		laFamilia.letra("Quiero brindar por mi gente sencilla, por el amor brindo por la familia")
		
		eres.duracion(145)
		eres.letra("Eres lo mejor que me pasó en la vida, no tengo duda, no habrá más nada después de ti. Eres lo que le dio brillo al día a día, y así será por siempre, no cambiará, hasta el final de mis días.")
		
		corazonAmericano.duracion(154)
		corazonAmericano.letra("Canta corazón, canta más alto, que tu pena al fin se va marchando, el nuevo milenio ha de encontrarnos, junto corazón, como soñamos.")
		
		almaDeDiamante.duracion(216)
		almaDeDiamante.letra("Ven a mí con tu dulce luz alma de diamante. Y aunque el sol se nuble después sos alma de diamante. Cielo o piel silencio o verdad sos alma de diamante. Por eso ven así con la humanidad alma de diamante")
		
		crisantemo.duracion(175)
		crisantemo.letra("Tócame junto a esta pared, yo quede por aquí... cuando no hubo más luz... quiero mirar a través de mi piel... Crisantemo, que se abrió... encuentra el camino hacia el cielo")
	
		remixLaFamilia.duracion(laFamilia)
		remixLaFamilia.letra(laFamilia)
		
		aliciaEnElPais.duracion(510)
		aliciaEnElPais.letra("Quién sabe Alicia, este país no estuvo hecho porque sí. Te vas a ir, vas a salir pero te quedas, ¿dónde más vas a ir? Y es que aquí, sabes el trabalenguas, trabalenguas, el asesino te asesina, y es mucho para ti. Se acabó ese juego que te hacía feliz.")
		
	
		//Presentaciones
		presentacionLunaPark.participantes([joaquin, lucia, luisAlberto])
		presentacionLaTrastienda.participantes([joaquin, lucia, luisAlberto])
		
		pdpalooza.condicionesParaParticipar([new CondicionDeHabilidad(70), new CondicionDeCancionBienInterpretada(aliciaEnElPais), new CondicionDeCompositor(1)])
		
		presentacionPrixDami.participantes([joaquin, soledad], elEternoRetorno.participantes())
		presentacionLaCueva.participantes(pimpisole.participantes())
		
	}

	test "si joaquin esta en pimpinela, su habilidad es 25" {
		assert.equals(joaquin.decimeTuHabilidad(), 25)
	}
	
	test "si joaquin esta como solista, su habilidad es 20"{
		pimpinela.renuncia(joaquin)
		assert.equals(joaquin.decimeTuHabilidad(),20)
	}
	
	test "si lucia esta en pimpinela, su habilidad es 50 "{
		assert.equals(lucia.decimeTuHabilidad(), 50)
	}
	
	test "si lucia renuncia de pimpinela, su habilidad es 70 "{
		pimpinela.renuncia(lucia)
		assert.equals(lucia.decimeTuHabilidad(), 70)
	}
	
	test "si Luis Alberto toca con la Fender, su habilidad es 80"{
		luisAlberto.instrumento(fender)
		assert.equals(luisAlberto.decimeTuHabilidad(), 80)
	}
	
	test "si Luis Alberto toca con la Gibson estando sana, su habilidad es 100"{
		luisAlberto.instrumento(gibson)
		assert.equals(luisAlberto.decimeTuHabilidad(), 100)
	}
	
	test "si Luis Alberto toca con la Gibson estando rota, su habilidad es 40"{
		luisAlberto.instrumento(gibsonRota)
		assert.equals(luisAlberto.decimeTuHabilidad(), 40)
	}
	
	test "Joaquin no interpreta bien la canción La Familia"{
		assert.that(joaquin.interpretaBien(laFamilia))	
	}
	
	test "Joaquin interpreta bien la canción Cisne"{
		assert.that(joaquin.interpretaBien(cisne))
	}
	
	test "Lucia interpreta bien la canción La Familia"{
		assert.that(lucia.interpretaBien(laFamilia))
	}
	
	test "Lucia interpreta bien la canción Cisne"{
		 assert.that(lucia.interpretaBien(cisne))
 
	}
	
	test "Luis Alberto interpreta bien la canción La Familia"{
		assert.that(luisAlberto.interpretaBien(laFamilia))
	}
	
	test "Luis Alberto interpreta bien la canción Cisne"{
		assert.that(luisAlberto.interpretaBien(cisne))
	}
	
//	test "Joaquin cobra 50, en la presentaciÃ²n del Luna Park"{
//		assert.equals(joaquin.precioPorTocarEn(presentacionLunaPark), 50)
//	}
//	
//	test "Joaquin cobra 100, si actua solo en la trastienda"{
//		presentacionLaTrastienda.participantes([joaquin])
//		assert.equals(joaquin.precioPorTocarEn(presentacionLaTrastienda), 100)
//	}
	
	test "La capacidad de La Trastienda para el 5/8/17, es 700"{
		assert.equals(laTrastienda.calcularCapacidad((new Date(05, 08, 2017))), 700)
		
	}
	
	test "La capacidad de La Trastienda para el 8/8/17, es 400"{
		assert.equals(laTrastienda.calcularCapacidad((new Date(08, 08, 2017))), 400)
	}
	
	
//	test "Lucia cobra 500, en la presentaciÃ²n del Luna Park"{
//		assert.equals(lucia.precioPorTocarEn(presentacionLunaPark), 500)
//	}
//	
//	test "Lucia cobra 400, en la presentaciÃ²n de La Trastienda"{
//		assert.equals(lucia.precioPorTocarEn(presentacionLaTrastienda), 400)
//	}
//	
//	test "Luis Alberto cobra 1000, en la presentaciÃ²n del Luna Park"{
//		assert.equals(luisAlberto.precioPorTocarEn(presentacionLunaPark), 1000)
//	}
//	
//	test "Luis Alberto cobra 1200, en la presentaciÃ²n de La Trastienda"{
//		assert.equals(luisAlberto.precioPorTocarEn(presentacionLaTrastienda), 1200)
//	}
//	
//
//	test "el costo de la presentacion del Luna Park es 1550 "{
//		assert.equals(presentacionLunaPark.decimeCostoTotal(), 1550)
//	}
//	
//	test "el costo de la presentacion de La Trastienda es 1650"{ 
//		assert.equals(presentacionLaTrastienda.decimeCostoTotal(), 1650)
//	}
	
	test "la cancion Crisantemo es corta"{
		assert.that(crisantemo.esCorta())
	}
	
	test "la cancion Alma de Diamante No es corta"{
		assert.notThat(almaDeDiamante.esCorta())
	}
	
	test "Soledad es minimalista"{
		assert.that(soledad.sosMinimalista())
	}

	test "Luis Alberto no es minimalista"{
		assert.notThat(luisAlberto.sosMinimalista())
	}

	test "Joaquin no es minimalista"{
		assert.notThat(joaquin.sosMinimalista())
	}
	
	test "Las canciones de Luis Alberto que tienen la palabra cielo son Crisantemo y Alma"{
		
		//Esto lo verificamos asi por el orden es las cacnciones. Aun asi, abajo esta comentado como se puede hacer el test con un equals
		var canciones = luisAlberto.cancionesQueTienenLaPalabra("cielo")
		assert.that(canciones.contains(almaDeDiamante))
		assert.that(canciones.contains(crisantemo))
//		assert.equals(luisAlberto.cancionesQueTienenLaPalabra("cielo"), [almaDeDiamante, crisantemo])
	}
	
	test "Ninguna cancion de Luis Alberto tienen la palabra pujante"{
		assert.equals(luisAlberto.cancionesQueTienenLaPalabra("pujante"), [])
	}
	
	test "La obra de kike dura 0 segundos"{
		assert.equals(kike.duracionTotalDeSuObra(), 0)
	}
	
	test "La obra de Soleadad dura 299 segundos"{
		assert.equals(soledad.duracionTotalDeSuObra(), 299)
	}
	
	test "La obra de Luis Alberto dura 703 segundos"{
		assert.equals(luisAlberto.duracionTotalDeSuObra(), 703)
	}
	
	test "La cancion mas larga del album para los arboles, es Alma de Diamante"{
		assert.equals(albumParaLosArboles.maximaCancionSegun(criterioDeLetra.getCriterio()), almaDeDiamante)
	}
	
	test "La cancion mas larga del album especial la familia, es la Familia"{
		assert.equals(albumEspecialLaFamilia.maximaCancionSegun(criterioDeLetra.getCriterio()), laFamilia)
	}
	
	test "Luis Alberto la pego"{
		assert.that(luisAlberto.laPego())
	}
	
	test "Soledad la pego"{
		assert.notThat(soledad.laPego())
	}
	
	test "Joaquin la pego"{
		assert.that(joaquin.laPego())
	}
	
	
	
	
	
	test "La duracion del remix de La Familia es 792"{
		assert.equals(remixLaFamilia.duracion(), 792)
	}

	test "Luis Alberto puede entrar a a pdpalooza"{
		luisAlberto.instrumento(gibson)
		pdpalooza.agregarMusico(luisAlberto)
		assert.that(pdpalooza.participantes().contains(luisAlberto))
	}

	test "Joaquin no puede entrar a pdpalooza como solista por que su habilidad no es suficiente"{
		pimpinela.renuncia(joaquin)
		const excepcionEsperada = new HabilidadRequeridaException("El musico no cumple con el minimo de habilidad requerido")
		const bloque = {
			 pdpalooza.agregarMusico(joaquin)
		}
		assert.throwsExceptionLike(excepcionEsperada, bloque)
	}
	

	test "Lucia no puede entrar a pdpalooza con una habilidad base de 90 por que no compuso ninguna cancion"{
		lucia.habilidadSolista(90)
		pimpinela.renuncia(lucia)
		const excepcionEsperada = new CompositorException("El musico no cumple con la cantidad minima de canciones compuestas")
		const bloque = {
			 pdpalooza.agregarMusico(lucia)
		}
		assert.throwsExceptionLike(excepcionEsperada, bloque)
	}

	test "Soleadad puede entrar a pdpalooza con una habilidad base de 80"{
		soledad.habilidadSolista(80)
		pdpalooza.agregarMusico(soledad)
		assert.that(pdpalooza.participantes().contains(soledad))
	}
	
	test "Joaquin pasa a ser imparero y canta bien 'La Familia'"{
		joaquin.tipoMusico(new MusicoImparero())
		assert.that(joaquin.interpretaBien(laFamilia))
	}
	
	test "Joaquin pasa a ser imparero y canta bien 'El Cisne'"{
		joaquin.tipoMusico(new MusicoImparero())
		assert.notThat(joaquin.interpretaBien(cisne))
	}
	
	test "Kike pasa a ser palabrero de DE e interpreta bien ciertas canciones"{
		
		var unasCanciones = [corazonAmericano, eres, laFamilia, cisne, almaDeDiamante, aliciaEnElPais, crisantemo]
		
		kike.tipoMusico((new MusicoPalabrero("de")))

		const canciones = kike.decimeCualInterpretasBien(unasCanciones)
		assert.equals(canciones.size(), 4)
		//assert.that(canciones.contains(corazonAmericano))
		//assert.that(canciones.contains(eres))
		//assert.that(canciones.contains(almaDeDiamante))
		//assert.that(canciones.contains(crisantemo))
		assert.equals(kike.decimeCualInterpretasBien([corazonAmericano, eres, laFamilia, cisne, almaDeDiamante, aliciaEnElPais, crisantemo]), [corazonAmericano, eres, almaDeDiamante, crisantemo])
	}
	
	
	
	
	test "si la habilidad de El eterno retorno es 154"{
		assert.equals(elEternoRetorno.decimeTuHabilidad(), 154)
	}
	
	test "la magia del Show de Prix D`Ami es 234"{
		assert.equals(presentacionPrixDami.decimeTuMagia(), 234)
		
	}
	
	test "si Pimpisole puede interpertar bien la canción Cisne"{
		assert.notThat(pimpisole.puedeTocarCancion(cisne))
	}
	
	test "si el eterno retorno puede interpretar bien la canción Crisantemo"{
		assert.that(elEternoRetorno.puedeTocarCancion(crisantemo))
	}
	
}